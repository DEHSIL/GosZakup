/**
 * Created by kirk on 03.03.2015.
 */

$(function () {

    var user_type = "";
    var lang = 'ru';
    var url;
    var controller;
    var folder = '';
    var method;
    var anno_id;

    function getAnnoId()
    {
        var url = window.location.href.split('/');
        return url[8];
    }

    function get_site_url()
    {
        url = window.location.href.split('/');
        controller = url[4];
        method = url[5];
        anno_id = url[6];

        switch (url[3]) {
            case 'kz':
                lang = url[3];
                break;
            case 'en':
                lang = url[3];
                break
            default:
                lang = 'ru';
                break;
        }
    }

    $(".btn-select-lot").click(function(){
        var lot_id = $(this).attr("data-lot-id");
        get_site_url();
        $.ajax({
            type: "POST",
            async: false,
            cache: false,
            url: "/" + lang + "/" + controller + "/ajax_load_lot/" + anno_id,
            data: {id:lot_id},
            success: function (data) {
                $(".modal-body-lot").html(data);
                $(".modal-lot").modal("show");
            },
            error: function () {
                $('.modal-body-lot').html('<div class="alert alert-danger">Ошибка выполнения запроса, попробуйте позже</div>');
                $(".modal-lot").modal("show");
            }
        });
    });

    $(".btn-select-history").click(function(){
        var lot_id = $(this).attr("data-lot-id");
        get_site_url();
        $.ajax({
            type: "POST",
            async: false,
            cache: false,
            url: "/" + lang + "/" + controller + "/ajax_load_history/" + anno_id,
            data: {id:lot_id},
            success: function (data) {
                $(".modal-body-lot").html(data);
                $(".modal-lot").modal("show");
            },
            error: function () {
                $('.modal-body-lot').html('<div class="alert alert-danger">Ошибка выполнения запроса, попробуйте позже</div>');
                $(".modal-lot").modal("show");
            }
        });
    });
});