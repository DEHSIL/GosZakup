/** @namespace helpers.union_lots */
genHelperNamespace(window, 'helpers.union_lots');

var lang = 'ru';
var url = window.location.href.split('/');
var http = location.protocol;
var hostname = window.location.hostname;

switch (url[3]) {
    case 'kz':
    case 'en':
        lang = url[3];
        break
    default:
        lang = 'ru';
        break;
}

var url_request = http + '//' + hostname + '/' + lang + '/union_lots/';


helpers.union_lots.get_announce_id = function(item) {
    if (url[6] == 'lots'){
        return url[7];
    } else {
        return url[6];
    }
}


helpers.union_lots.get_lot_id = function(item) {
    if (url[6] == 'lots'){
        return url[8];
    } else {
        return url[7];
    }
}

helpers.union_lots.save_union_lots_form = function (item) {
    $('#error_msg').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_save_form/' + helpers.union_lots.get_announce_id(),
        dataType: 'json',
        data: $('#union_lots_form').serialize(),
        success: function (responseData) {
            if (responseData.status == "ok") {
                location.reload();
            }
            else {
                $('#error_msg').html('<div class="alert alert-danger">' + responseData.message + '</div>');
            }
            $btn.button('reset');
        },
        error: function () {
            $('#error_msg').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });

    return false;
};

helpers.union_lots.edit_union_lots_form = function (item) {
    $('#error_msg').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_save_form/' + helpers.union_lots.get_announce_id() + '/' + $(item).data('id'),
        dataType: 'json',
        data: $('#union_lots_form').serialize(),
        success: function (responseData) {
            if (responseData.status == "ok") {
                location.reload();
            }
            else {
                $('#error_msg').html('<div class="alert alert-danger">' + responseData.message + '</div>');
            }
            $btn.button('reset');
        },
        error: function () {
            $('#error_msg').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });

    return false;
};

helpers.union_lots.btn_add_point_agree = function () {
    $('#modal_union_lot_warning').modal('hide');
    $('.modal_union_lot_warning-body').html('');
    helpers.union_lots.add_points($("#add_lots"), 1);
};

helpers.union_lots.btn_add_point_cancel = function () {
    $('#modal_union_lot_warning').modal('hide');
    $('.modal_union_lot_warning-body').html('');
};

helpers.union_lots.add_points = function (item, confirm = 0) {
    $('#error_msg_avl').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_add_points/' + helpers.union_lots.get_announce_id() + '/' + helpers.union_lots.get_lot_id(),
        dataType: 'json',
        data: $('#available_points').serialize() + '&confirm=' + confirm,
        success: function (responseData) {
            if (responseData.status == "ok") {
                location.reload();
            } else if (responseData.status == 'warning') {
                $('#modal_union_lot_warning').modal({backdrop: 'static', keyboard: false, show: true});
                $('.modal_union_lot_warning-body').html(responseData.message);
            }
            else {
                $('#error_msg_avl').html('<div class="alert alert-danger">' + responseData.message + '</div>');
            }
            $btn.button('reset');
        },
        error: function () {
            $('#error_msg_avl').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });

    return false;
};

helpers.union_lots.add_lots = function (item) {
    $('#error_msg_avl').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_add_lots/' + helpers.union_lots.get_announce_id(),
        dataType: 'json',
        data: $('#available_lots').serialize(),
        success: function (responseData) {
            if (responseData.status == "ok") {
                location.reload();
            }
            else {
                $('#error_msg_avl').html('<div class="alert alert-danger">' + responseData.message + '</div>');
            }
            $btn.button('reset');
        },
        error: function () {
            $('#error_msg_avl').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });

    return false;
};

helpers.union_lots.check_lots = function (item) {
    $('#error_msg_avl').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_check_lots/' + helpers.union_lots.get_announce_id(),
        data: $('#available_lots').serialize(),
        dataType: 'json',
        success: function (data)
        {
            if (data.status == 1){
                helpers.union_lots.add_lots(item);
            }
            else if (data.status == 2){
                $('#modal_singlorg_warning').modal({backdrop: 'static', keyboard: false, show: true});
                $('.modal_singlorg_warning-body').html(data.message);
                $btn.button('reset');
            }else if (data.status == 0){
                $('#error_msg_avl').html('<div class="alert alert-danger">' + data.message + '</div>');
            }
        },
        error: function () {
            $('#error_msg_avl').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });
    return false;
}

helpers.union_lots.delete_points = function (item) {
    $('#error_msg_avl').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_delete_lots/' + helpers.union_lots.get_announce_id() + '/' + helpers.union_lots.get_lot_id() ,
        dataType: 'json',
        data: $('#added_lots').serialize(),
        success: function (responseData) {
            if (responseData.status == "ok") {
                location.reload();
            }
            else {
                $('#error_msg_add').html('<div class="alert alert-danger">' + responseData.message + '</div>');
            }
            $btn.button('reset');
        },
        error: function () {
            $('#error_msg_avl').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });

    return false;
};

helpers.union_lots.delete_union_lot = function (item) {
    $('#error_msg').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_delete_union_lot/' + helpers.union_lots.get_announce_id() + '/' + $(item).data('id'),
        dataType: 'json',
        data: {delete: 'Y'},
        success: function (responseData) {
            if (responseData.status == "ok") {
                location.reload();
            }
            else {
                $('#error_msg').html('<div class="alert alert-danger">' + responseData.message + '</div>');
            }
            $btn.button('reset');
        },
        error: function () {
            $('#error_msg').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });

    return false;
};

helpers.union_lots.show_union_lot = function (item) {
    $('#error_msg').empty();
    var result = false;
    $.ajax({
        type: "get",
        async: false,
        url: url_request + 'ajax_union_lot/' + helpers.union_lots.get_announce_id() + '/' + $(item).data('id'),
        dataType: 'json',
        success: function (responseData) {
            result = responseData;
        },
        error: function () {
            $('#error_msg').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            return false;
        }
    });
    return result;
};

helpers.union_lots.save_info_union_lot = function (item) {
    $('#error_msg').empty();
    var $btn = $(item).button('loading');
    $.ajax({
        type: "POST",
        url: url_request + 'ajax_save_info/' + helpers.union_lots.get_announce_id() + '/' + helpers.union_lots.get_lot_id() ,
        dataType: 'json',
        data: $('#addLotsInfo').serialize(),
        success: function (responseData) {
            if (responseData.status == "ok") {
                location.reload();
            }
            else {
                $('#error_msg').html('<div class="alert alert-danger">' + responseData.message + '</div>');
            }
            $btn.button('reset');
        },
        error: function () {
            $('#error_msg').html('<div class="alert alert-danger">Ошибка выполнения запроса</div>');
            $btn.button('reset');
        }
    });

    return false;
};

